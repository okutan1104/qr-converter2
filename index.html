<!doctype html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>QRå¤‰æ›ãƒ„ãƒ¼ãƒ«ï¼ˆæ—§â†’æ–°ï¼‰å®Œå…¨ç‰ˆ</title>
<style>
body {
  font-family: sans-serif;
  background: #f4f6f8;
  text-align: center;
  padding: 1.2rem;
}
h1 {
  font-size: 1.3rem;
  color: #333;
  margin-bottom: 0.8rem;
}
#video {
  width: 100%;
  max-width: 360px;
  border: 2px solid #ccc;
  border-radius: 0.6rem;
  display: none;
}
#result {
  margin-top: 1rem;
  font-size: 0.9rem;
  word-break: break-all;
}
button {
  margin-top: 0.5rem;
  padding: 0.8rem 1.2rem;
  border: none;
  border-radius: 0.6rem;
  background: #0078d7;
  color: white;
  font-size: 1rem;
}
button:hover {
  background: #005fa3;
}
hr { margin: 1rem auto; width: 80%; }
#newQR { margin-top: 1rem; }
footer {
  margin-top: 2rem;
  color: #666;
  font-size: 0.8rem;
}
input {
  width: 90%;
  max-width: 360px;
  padding: 0.6rem;
  border: 1px solid #ccc;
  border-radius: 0.4rem;
}
</style>
</head>
<body>
  <h1>ğŸ“± QRãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå¤‰æ›ãƒ„ãƒ¼ãƒ«</h1>

  <button id="startBtn">ğŸ“· ã‚«ãƒ¡ãƒ©èµ·å‹•ã—ã¦æ—§QRã‚’èª­ã¿å–ã‚‹</button>
  <br>
  <video id="video" autoplay playsinline></video>

  <hr>
  <div>
    <p>ã¾ãŸã¯æ‰‹å‹•å…¥åŠ›ï¼š</p>
    <input id="manualInput" placeholder='"2025/10/31","ARACRD705082","22","PARA00001765","SEIKEI"'>
    <button id="convertBtn">å¤‰æ›ã—ã¦æ–°QRç”Ÿæˆ</button>
  </div>

  <div id="result"></div>
  <div id="newQR"></div>

  <footer>Â© 2025 QR Layout Converter</footer>

  <script src="https://cdn.jsdelivr.net/npm/qr-scanner@1.4.2/qr-scanner.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>

  <script>
  const video = document.getElementById('video');
  const startBtn = document.getElementById('startBtn');
  const convertBtn = document.getElementById('convertBtn');
  const manualInput = document.getElementById('manualInput');
  const resultDiv = document.getElementById('result');
  const newQRDiv = document.getElementById('newQR');
  let scanner = null;

  function convertOldToNew(oldText) {
    if (!oldText) return "";
    const parts = oldText.replaceAll('"', '').split(',');
    const code = parts[1] || '';
    const num = parseFloat(parts[2] || '0');
    const newCode = code.replace(/82$/, '72');
    const newNum = num.toFixed(3);
    const newLayout = `,,${newCode},999,,${newNum}`;
    return newLayout;
  }

  function showResult(oldText){
    const newText = convertOldToNew(oldText);
    resultDiv.innerHTML = `
      <div style="margin-bottom:.5rem;color:#333;">æ—§QRå†…å®¹ï¼š</div>
      <div style="color:#555">${oldText}</div>
      <hr>
      <div style="color:#333;">â¡ æ–°QRå†…å®¹ï¼š</div>
      <div style="font-weight:bold;color:green;">${newText}</div>
    `;
    newQRDiv.innerHTML = "";
    new QRCode(newQRDiv, {
      text: newText,
      width: 220,
      height: 220,
      correctLevel: QRCode.CorrectLevel.H
    });
  }

  async function startScan() {
    if (scanner) {
      scanner.stop();
      scanner.destroy();
      scanner = null;
      startBtn.textContent = "ğŸ“· ã‚«ãƒ¡ãƒ©èµ·å‹•ã—ã¦æ—§QRã‚’èª­ã¿å–ã‚‹";
      video.style.display = "none";
      return;
    }
    video.style.display = "block";
    scanner = new QrScanner(video, result => {
      const oldText = result.data;
      scanner.stop();
      video.style.display = "none";
      startBtn.textContent = "å†ã‚¹ã‚­ãƒ£ãƒ³";
      showResult(oldText);
    }, { returnDetailedScanResult: true });
    await scanner.start();
    startBtn.textContent = "ã‚¹ã‚­ãƒ£ãƒ³åœæ­¢";
  }

  startBtn.onclick = startScan;
  convertBtn.onclick = () => {
    const txt = manualInput.value.trim();
    if (txt) showResult(txt);
  };
  </script>
</body>
</html>